name = "quartz-faas"
main = "build/index.js"
compatibility_date = "2024-01-01"
workers_dev = true

# Custom domain
routes = [
  { pattern = "api.quartzdb.io", custom_domain = true }
]

[build]
command = "cargo install -q worker-build && worker-build --release"

# Durable Objects Configuration
[[durable_objects.bindings]]
name = "STORAGE"
class_name = "StorageObject"
script_name = "quartz-faas"

[[durable_objects.bindings]]
name = "VECTOR_INDEX"
class_name = "VectorIndexObject"
script_name = "quartz-faas"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["StorageObject", "VectorIndexObject"]

# Analytics Engine Configuration (disabled - requires manual enablement in dashboard)
# [[analytics_engine_datasets]]
# binding = "ANALYTICS"

[env.production]
name = "quartz-faas-prod"
workers_dev = false

[[env.production.durable_objects.bindings]]
name = "STORAGE"
class_name = "StorageObject"
script_name = "quartz-faas-prod"

[[env.production.durable_objects.bindings]]
name = "VECTOR_INDEX"
class_name = "VectorIndexObject"
script_name = "quartz-faas-prod"
